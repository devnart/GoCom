!function(a,b,c,d){"use strict";var e,f,g;e={activateCurrent:function(a){this.html_element.find("select").val(a)},getHtml:function(){var b,c,d=this,e="";if(this.ln>1){for(e+='<select class="dropdown controls '+this.o.controls_cssclass+'">',this.ShowOnMenu(this.view_all_key)&&(e+='<option value="'+this.view_all_key+'">'+this.o.view_all_text+"</option>"),c=0;c<this.ln;c+=1)this.ShowOnMenu(c)&&(e+='<option value="'+(c+1)+'">'+(this.o.locations[c].title||"#"+(c+1))+"</option>");e+="</select>",e=a(e).bind("change",function(){d.ViewOnMap(this.value)})}return b=this.o.controls_title,this.o.controls_title&&(b=a('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",fontSize:this.o.controls_on_map?"12px":"inherit",padding:"3px 10px 5px 0"}:{}).append(this.o.controls_title)),this.html_element=a('<div class="wrap_controls"></div>').append(b).append(e),this.html_element}},f={html_a:function(b,c,d){var e=this,f=c||b+1,g=d||this.o.locations[b].title,h=a('<a data-load="'+f+'" id="ullist_a_'+f+'" href="#'+f+'" title="'+g+'"><span>'+(g||"#"+(b+1))+"</span></a>");return h.css(this.o.controls_applycss?{color:"#666",display:"block",padding:"5px",fontSize:this.o.controls_on_map?"12px":"inherit",textDecoration:"none"}:{}),h.on("click",function(b){b.preventDefault();var c=a(this).attr("data-load");e.ViewOnMap(c)}),h},activateCurrent:function(a){this.html_element.find("li").removeClass("active"),this.html_element.find("#ullist_a_"+a).parent().addClass("active")},getHtml:function(){var b,c,d=a("<ul class='ullist controls "+this.o.controls_cssclass+"'></ul>").css(this.o.controls_applycss?{margin:0,padding:0,listStyleType:"none"}:{});for(this.ShowOnMenu(this.view_all_key)&&d.append(a("<li></li>").append(f.html_a.call(this,!1,this.view_all_key,this.o.view_all_text))),c=0;c<this.ln;c++)this.ShowOnMenu(c)&&d.append(a("<li></li>").append(f.html_a.call(this,c)));return b=this.o.controls_title,this.o.controls_title&&(b=a('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",padding:"3px 10px 5px 0",fontSize:this.o.controls_on_map?"12px":"inherit"}:{}).append(this.o.controls_title)),this.html_element=a('<div class="wrap_controls"></div>').append(b).append(d),this.html_element}},g=function(){function b(b){this.VERSION="0.1.33",this.loaded=!1,this.markers=[],this.circles=[],this.oMap=!1,this.view_all_key="all",this.infowindow=null,this.maxZIndex=0,this.ln=0,this.oMap=!1,this.oBounds=null,this.map_div=null,this.canvas_map=null,this.controls_wrapper=null,this.current_control=null,this.current_index=null,this.Polyline=null,this.Polygon=null,this.Fusion=null,this.directionsService=null,this.directionsDisplay=null,this.o={debug:!1,map_div:"#gmap",controls_div:"#controls",generate_controls:!0,controls_type:"dropdown",controls_cssclass:"",controls_title:"",controls_on_map:!0,controls_applycss:!0,controls_position:c.maps.ControlPosition.RIGHT_TOP,type:"marker",view_all:!0,view_all_text:"View All",pan_on_click:!0,start:0,locations:[],shared:{},map_options:{mapTypeId:c.maps.MapTypeId.ROADMAP},stroke_options:{strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.4},directions_options:{travelMode:c.maps.TravelMode.DRIVING,unitSystem:c.maps.UnitSystem.METRIC,optimizeWaypoints:!1,provideRouteAlternatives:!1,avoidHighways:!1,avoidTolls:!1},circle_options:{radius:100,visible:!0},styles:{},fusion_options:{},directions_panel:null,draggable:!1,editable:!1,show_infowindows:!0,show_markers:!0,infowindow_type:"bubble",listeners:{},beforeViewAll:function(){},afterViewAll:function(){},beforeShow:function(a,b,c){},afterShow:function(a,b,c){},afterCreateMarker:function(a,b,c){},beforeCloseInfowindow:function(a,b){},afterCloseInfowindow:function(a,b){},beforeOpenInfowindow:function(a,b,c){},afterOpenInfowindow:function(a,b,c){},afterRoute:function(a,b,c){},onPolylineClick:function(a){},onPolygonClick:function(a){},circleRadiusChanged:function(a,b,c){},circleCenterChanged:function(a,b,c){},drag:function(a,b,c){},dragEnd:function(a,b,c){},dragStart:function(a,b,c){}},this.AddControl("dropdown",e),this.AddControl("list",f),b&&"directions"===b.type&&(!b.show_markers&&(b.show_markers=!1),!b.show_infowindows&&(b.show_infowindows=!1)),a.extend(!0,this.o,b)}return b.prototype.controls={},b.prototype.create_objMap=function(){var b,d=this,e=0;for(b in this.o.styles)this.o.styles.hasOwnProperty(b)&&(0===e&&(this.o.map_options.mapTypeControlOptions={mapTypeIds:[c.maps.MapTypeId.ROADMAP]}),e++,this.o.map_options.mapTypeControlOptions.mapTypeIds.push("map_style_"+e));if(this.loaded)d.oMap.setOptions(this.o.map_options);else try{this.map_div.css({position:"relative",overflow:"hidden"}),this.canvas_map=a("<div>").addClass("canvas_map").css({width:"100%",height:"100%"}).appendTo(this.map_div),this.oMap=new c.maps.Map(this.canvas_map.get(0),this.o.map_options)}catch(f){this.debug("create_objMap::"+this.map_div.selector,f.toString())}e=0;for(b in this.o.styles)this.o.styles.hasOwnProperty(b)&&(e++,this.oMap.mapTypes.set("map_style_"+e,new c.maps.StyledMapType(this.o.styles[b],{name:b})),this.oMap.setMapTypeId("map_style_"+e))},b.prototype.add_markers_to_objMap=function(){var a,b,c=this.o.type||"marker";switch(c){case"marker":for(a=0;a<this.ln;a++)b=this.create_objPoint(a),this.create.marker.call(this,a,b);break;default:this.create[c].apply(this)}},b.prototype.create_objPoint=function(b){var e=a.extend({},this.o.locations[b]),f=e.visible===d?d:e.visible;return!e.type&&(e.type=this.o.type),e.map=this.oMap,e.position=new c.maps.LatLng(e.lat,e.lon),e.zIndex=e.zIndex===d?1e4:e.zIndex+100,e.visible=f===d?this.o.show_markers:f,this.o.maxZIndex=e.zIndex>this.maxZIndex?e.zIndex:this.maxZIndex,e.image&&(e.icon=new c.maps.MarkerImage(e.image,new c.maps.Size(e.image_w||32,e.image_h||32),new c.maps.Point(0,0),new c.maps.Point((e.image_w||32)/2,(e.image_h||32)/2))),e},b.prototype.create_objCircle=function(b){var c,d,e;return e=a.extend({},b),c=a.extend({},this.o.stroke_options),d=a.extend({},this.o.circle_options),a.extend(c,b.stroke_options||{}),a.extend(e,c),a.extend(d,b.circle_options||{}),a.extend(e,d),e.center=b.position,e.draggable=!1,e.zIndex=b.zIndex>0?b.zIndex-10:1,e},b.prototype.add_markerEv=function(a,b,d){var e=this;c.maps.event.addListener(d,"click",function(c){e.o.beforeShow(a,b,d),e.o.show_infowindows&&!1!==b.show_infowindow&&e.open_infowindow(a,d,c),e.o.pan_on_click&&!1!==b.pan_on_click&&(e.oMap.panTo(b.position),b.zoom&&e.oMap.setZoom(b.zoom)),e.current_control&&e.o.generate_controls&&e.current_control.activateCurrent&&e.current_control.activateCurrent.call(e,a+1),e.current_index=a,e.o.afterShow(a,b,d)}),b.draggable&&this.add_dragEv(a,b,d)},b.prototype.add_circleEv=function(a,b,d){var e=this;c.maps.event.addListener(d,"click",function(){e.ViewOnMap(a+1)}),c.maps.event.addListener(d,"center_changed",function(){e.o.circleCenterChanged(a,b,d)}),c.maps.event.addListener(d,"radius_changed",function(){e.o.circleRadiusChanged(a,b,d)}),b.draggable&&this.add_dragEv(a,b,d)},b.prototype.add_dragEv=function(a,b,d){var e=this;c.maps.event.addListener(d,"drag",function(f){var g,h;if(d.getPosition)g=d.getPosition();else{if(!d.getCenter)return;g=d.getCenter()}if(e.circles[a]&&e.circles[a].setCenter(g),e.Polyline?h="Polyline":e.Polygon&&(h="Polygon"),h){for(var i=e[h].getPath(),j=i.getArray(),k=[],l=0;l<j.length;++l)k[l]=a===l?new c.maps.LatLng(g.lat(),g.lng()):new c.maps.LatLng(j[l].lat(),j[l].lng());e[h].setPath(new c.maps.MVCArray(k)),e.add_polyEv(h)}e.o.drag(a,b,d)}),c.maps.event.addListener(d,"dragend",function(){e.o.dragEnd(a,b,d)}),c.maps.event.addListener(d,"dragstart",function(){e.o.dragStart(a,b,d)}),c.maps.event.addListener(d,"center_changed",function(){e.markers[a]&&d.getCenter&&e.markers[a].setPosition(d.getCenter()),e.o.drag(a,b,d)})},b.prototype.add_polyEv=function(a){var b=this;c.maps.event.addListener(this[a].getPath(),"set_at",function(d,e){var f=b[a].getPath().getAt(d),g=new c.maps.LatLng(f.lat(),f.lng());b.markers[d]&&b.markers[d].setPosition(g),b.circles[d]&&b.circles[d].setCenter(g),b.o["on"+a+"Changed"](d,e,b[a].getPath().getArray())})},b.prototype.create={marker:function(a,b,d){var e;return"circle"!=b.type||d||(e=this.create_objCircle(b),b.visible||(e.draggable=b.draggable),d=new c.maps.Circle(e),this.add_circleEv(a,e,d),this.circles[a]=d),b.type="marker",d=new c.maps.Marker(b),this.add_markerEv(a,b,d),this.oBounds.extend(b.position),this.markers[a]=d,this.o.afterCreateMarker(a,b,d),d},circle:function(){var a,b,d,e;for(a=0;a<this.ln;a++)b=this.create_objPoint(a),"circle"==b.type&&(d=this.create_objCircle(b),b.visible||(d.draggable=b.draggable),e=new c.maps.Circle(d),this.add_circleEv(a,d,e),this.circles[a]=e),b.type="marker",this.create.marker.call(this,a,b,e)},polyline:function(){var b,d,e=a.extend({},this.o.stroke_options);for(e.path=[],e.draggable=this.o.draggable,e.editable=this.o.editable,e.map=this.oMap,e.zIndex=this.o.maxZIndex+100,b=0;b<this.ln;b++)d=this.create_objPoint(b),this.create.marker.call(this,b,d),e.path.push(d.position);this.Polyline?this.Polyline.setOptions(e):this.Polyline=new c.maps.Polyline(e),this.add_polyEv("Polyline")},polygon:function(){var b,d,e=this,f=a.extend({},this.o.stroke_options);for(f.path=[],f.draggable=this.o.draggable,f.editable=this.o.editable,f.map=this.oMap,f.zIndex=this.o.maxZIndex+100,b=0;b<this.ln;b++)d=this.create_objPoint(b),this.create.marker.call(this,b,d),f.path.push(d.position);this.Polygon?this.Polygon.setOptions(f):this.Polygon=new c.maps.Polygon(f),c.maps.event.addListener(this.Polygon,"click",function(a){e.o.onPolygonClick(a)}),this.add_polyEv("Polygon")},fusion:function(){this.o.fusion_options.styles=[this.o.stroke_options],this.o.fusion_options.map=this.oMap,this.Fusion?this.Fusion.setOptions(this.o.fusion_options):this.Fusion=new c.maps.FusionTablesLayer(this.o.fusion_options)},directions:function(){var b,d,e,f,g,h=this,i=[],j=0;for(b=0;b<this.ln;b++)d=this.create_objPoint(b),0===b?f=d.position:b===this.ln-1?g=d.position:(e=!0===this.o.locations[b].stopover,i.push({location:d.position,stopover:e})),this.create.marker.call(this,b,d);this.o.directions_options.origin=f,this.o.directions_options.destination=g,this.o.directions_options.waypoints=i,this.directionsService||(this.directionsService=new c.maps.DirectionsService),this.directionsDisplay?this.directionsDisplay.setOptions({draggable:this.o.draggable}):this.directionsDisplay=new c.maps.DirectionsRenderer({draggable:this.o.draggable}),this.directionsDisplay.setMap(this.oMap),this.o.directions_panel&&(this.o.directions_panel=a(this.o.directions_panel),this.directionsDisplay.setPanel(this.o.directions_panel.get(0))),this.o.draggable&&c.maps.event.addListener(this.directionsDisplay,"directions_changed",function(){j=h.compute_distance(h.directionsDisplay.directions),h.o.afterRoute(j)}),this.directionsService.route(this.o.directions_options,function(a,b){b===c.maps.DirectionsStatus.OK&&(j=h.compute_distance(a),h.directionsDisplay.setDirections(a)),h.o.afterRoute(j,b,a)})}},b.prototype.compute_distance=function(a){var b,c=0,d=a.routes[0],e=d.legs.length;for(b=0;b<e;b++)c+=d.legs[b].distance.value;return c},b.prototype.type_to_open={bubble:function(a){this.infowindow=new c.maps.InfoWindow({content:a.html||""})}},b.prototype.open_infowindow=function(a,b,c){this.CloseInfoWindow();var d=this.o.locations[a],e=this.o.infowindow_type;d.html&&this.type_to_open[e]&&(this.o.beforeOpenInfowindow(a,d,b),this.type_to_open[e].call(this,d),this.infowindow.open(this.oMap,b),this.o.afterOpenInfowindow(a,d,b))},b.prototype.get_html_controls=function(){return this.controls[this.o.controls_type]&&this.controls[this.o.controls_type].getHtml?(this.current_control=this.controls[this.o.controls_type],this.current_control.getHtml.apply(this)):""},b.prototype.generate_controls=function(){if(!this.o.controls_on_map)return this.controls_wrapper.empty(),void this.controls_wrapper.append(this.get_html_controls());var b=a('<div class="on_gmap '+this.o.controls_type+' gmap_controls"></div>').css(this.o.controls_applycss?{margin:"5px"}:{}),c=a(this.get_html_controls()).css(this.o.controls_applycss?{background:"#fff",padding:"5px",border:"1px solid rgb(113,123,135)",boxShadow:"rgba(0, 0, 0, 0.4) 0px 2px 4px",maxHeight:this.map_div.find(".canvas_map").outerHeight()-80,minWidth:100,overflowY:"auto",overflowX:"hidden"}:{});b.append(c),this.oMap.controls[this.o.controls_position].push(b.get(0))},b.prototype.init_map=function(){var a=this;this.Polyline&&this.Polyline.setMap(null),this.Polygon&&this.Polygon.setMap(null),this.Fusion&&this.Fusion.setMap(null),this.directionsDisplay&&this.directionsDisplay.setMap(null);for(var b=this.markers.length-1;b>=0;b-=1)try{this.markers[b]&&this.markers[b].setMap(null)}catch(d){a.debug("init_map::markers::setMap",d.stack)}this.markers.length=0,this.markers=[];for(var b=this.circles.length-1;b>=0;b-=1)try{this.circles[b]&&this.circles[b].setMap(null)}catch(d){a.debug("init_map::circles::setMap",d.stack)}this.circles.length=0,this.circles=[],this.o.controls_on_map&&this.oMap.controls&&this.oMap.controls[this.o.controls_position].forEach(function(b,c){try{a.oMap.controls[this.o.controls_position].removeAt(c)}catch(d){a.debug("init_map::removeAt",d.stack)}}),this.oBounds=new c.maps.LatLngBounds},b.prototype.perform_load=function(){1===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new c.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):(this.oMap.fitBounds(this.oBounds),this.ViewOnMap(1)),this.o.map_options.zoom&&this.oMap.setZoom(this.o.map_options.zoom)):0===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new c.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.oMap.fitBounds(this.oBounds),this.oMap.setZoom(this.o.map_options.zoom||1)):(this.oMap.fitBounds(this.oBounds),"number"==typeof(this.o.start-0)&&this.o.start>0&&this.o.start<=this.ln?this.ViewOnMap(this.o.start):this.o.map_options.set_center?this.oMap.setCenter(new c.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.ViewOnMap(this.view_all_key),this.o.map_options.zoom&&this.oMap.setZoom(this.o.map_options.zoom))},b.prototype.debug=function(a,b){return this.o.debug&&console.log(a,b),this},b.prototype.AddControl=function(a,b){return a&&b?(this.controls[a]=b,this):(self.debug("AddControl",'Missing "name" and "func" callback.'),!1)},b.prototype.CloseInfoWindow=function(){return this.infowindow&&(this.current_index||0===this.current_index)&&(this.o.beforeCloseInfowindow(this.current_index,this.o.locations[this.current_index]),this.infowindow.close(),this.infowindow=null,this.o.afterCloseInfowindow(this.current_index,this.o.locations[this.current_index])),this},b.prototype.ShowOnMenu=function(a){if(a===this.view_all_key&&this.o.view_all&&this.ln>1)return!0;if("number"==typeof((a=parseInt(a,10))-0)&&a>=0&&a<this.ln){if(!1!==this.o.locations[a].on_menu)return!0}return!1},b.prototype.ViewOnMap=function(a){if(a===this.view_all_key)this.o.beforeViewAll(),this.current_index=a,this.o.locations.length>0&&this.o.generate_controls&&this.current_control&&this.current_control.activateCurrent&&this.current_control.activateCurrent.apply(this,[a]),this.oMap.fitBounds(this.oBounds),this.CloseInfoWindow(),this.o.afterViewAll();else if("number"==typeof((a=parseInt(a,10))-0)&&a>0&&a<=this.ln)try{c.maps.event.trigger(this.markers[a-1],"click")}catch(b){this.debug("ViewOnMap::trigger",b.stack)}return this},b.prototype.SetLocations=function(a,b){return this.o.locations=a,b&&this.Load(),this},b.prototype.AddLocations=function(b,c){var d=this;return a.isArray(b)&&a.each(b,function(a,b){d.o.locations.push(b)}),a.isPlainObject(b)&&this.o.locations.push(b),c&&this.Load(),this},b.prototype.AddLocation=function(b,c,d){return a.isPlainObject(b)&&this.o.locations.splice(c,0,b),d&&this.Load(),this},b.prototype.RemoveLocations=function(b,c){var d=this,e=0;return a.isArray(b)?a.each(b,function(a,b){b-e<d.ln&&d.o.locations.splice(b-e,1),e++}):b<this.ln&&this.o.locations.splice(b,1),c&&this.Load(),this},b.prototype.Loaded=function(){return this.loaded},b.prototype._init=function(){this.ln=this.o.locations.length;for(var b=0;b<this.ln;b++){var c=a.extend({},this.o.shared);this.o.locations[b]=a.extend(c,this.o.locations[b]),this.o.locations[b].html&&(this.o.locations[b].html=this.o.locations[b].html.replace("%index",b+1),this.o.locations[b].html=this.o.locations[b].html.replace("%title",this.o.locations[b].title||""))}return this.map_div=a(this.o.map_div),this.controls_wrapper=a(this.o.controls_div),this},b.prototype.Load=function(b){a.extend(!0,this.o,b),b&&b.locations&&(this.o.locations=b.locations),this._init(),!1===this.o.visualRefresh?c.maps.visualRefresh=!1:c.maps.visualRefresh=!0,this.init_map(),this.create_objMap(),this.add_markers_to_objMap(),this.ln>1&&this.o.generate_controls||this.o.force_generate_controls?(this.o.generate_controls=!0,this.generate_controls()):this.o.generate_controls=!1;var d=this;if(this.loaded)this.perform_load();else{c.maps.event.addListenerOnce(this.oMap,"idle",function(){d.perform_load()}),c.maps.event.addListener(this.oMap,"resize",function(){d.canvas_map.css({width:d.map_div.width(),height:d.map_div.height()})});var e;for(e in this.o.listeners){var f=this.oMap,g=this.o.listeners[e];this.o.listeners.hasOwnProperty(e)&&c.maps.event.addListener(this.oMap,e,function(a){g(f,a)})}}return this.loaded=!0,this},b}(),"function"==typeof define&&define.amd?define(function(){return g}):b.Maplace=g}(jQuery,this,google);